generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("POSTGRES_URL") // uses connection pooling
}

enum Role {
  ADMIN // Administrator with full system access
  STAFF // Shelter staff with operational privileges
  USER // Regular user, can browse animals and apply for adoption
  VOLUNTEER // Volunteer with limited access, can view animals and applications
}

enum CharacteristicCategory {
  BEHAVIOR // For behavioral notes like "Bite History", "On-Leash Reactivity"
  MEDICAL // For health-related tags like "Deaf", "Heartworm Positive"
  ENVIRONMENT // For home-related needs like "Good With Kids", "Housebroken"
  ADMINISTRATIVE // For internal, process-related tags like "Adoption Fee Waived"
  OTHER // For any other tags that don't fit the above categories
}

enum MedicalRecordType {
  VACCINATION // For recording immunizations like Rabies, DHPP, etc.
  PROCEDURE // For surgeries like spay/neuter, dental cleaning
  MEDICATION // For prescribed drugs
  ALLERGY // To note known allergies
  CHECKUP // A general vet visit or check-up
  NOTE // A general health-related note
}

enum PersonType {
  INDIVIDUAL
  AGENCY // For shelters, rescues, vet clinics, etc.
}

enum OutcomeType {
  ADOPTION
  TRANSFER_OUT
  RETURN_TO_OWNER
  DECEASED
  OTHER
}

enum TaskCategory {
  MEDICAL
  BEHAVIORAL
  ADMINISTRATIVE
  CLEANING
  FEEDING
}

enum AnimalActivityType {
  FIELD_UPDATE // A direct field on the animal model was changed (e.g., name, weight)
  NOTE_ADDED // A note was created for this animal
  PHOTO_UPLOADED // A new photo was added
  MEDICAL_RECORD_ADDED // A medical record was created
  ASSESSMENT_COMPLETED // An assessment was finished
  TASK_CREATED // A task was created
  TASK_STATUS_CHANGED // A task's status was updated
  STATUS_CHANGE // A significant status like listing or health status changed
  INTAKE_PROCESSED // The initial intake event
  OUTCOME_PROCESSED // A final outcome event
  CREATED // The animal record itself was created
}

enum TaskStatus {
  TODO
  IN_PROGRESS
  DONE
  SKIPPED // Task was skipped, not completed
  CANCELED
  ON_HOLD
  DELETED // Task is deleted but kept for records
}

enum TaskPriority {
  HIGH
  MEDIUM
  LOW
}

enum NoteCategory {
  BEHAVIORAL
  MEDICAL
  FEEDING
  GENERAL
  ADOPTION_UPDATE
  FOSTER_UPDATE
}

enum AnimalSize {
  SMALL
  MEDIUM
  LARGE
  XLARGE
}

enum IntakeType {
  OWNER_SURRENDER // OS / Return
  STRAY
  BORN_IN_CARE
  TRANSFER_IN
  SEIZE // e.g., from a legal case
  SERVICE_IN // e.g., temporary boarding for a community member
  ACO_IMPOUND // Animal Control impound
}

enum AnimalLegalStatus {
  NONE
  STRAY_HOLD
  BITE_QUARANTINE
  COURT_HOLD
  POLICE_HOLD
  PROTECTIVE_CUSTODY
}

enum Sex {
  MALE
  FEMALE
  UNKNOWN
}

enum AnimalHealthStatus {
  HEALTHY
  AWAITING_VET_EXAM
  AWAITING_TRIAGE
  UNDER_VET_CARE
  HOSPITALISED
  AWAITING_SPAY_NEUTER
  AWAITING_OTHER_SURGERY
  RECOVERING_FROM_SURGERY
}

enum AnimalListingStatus {
  DRAFT // Profile is being prepared, not yet ready for public view.
  PUBLISHED // Profile is live, publicly accessible, and available for applications.
  PENDING_ADOPTION // An application has been approved; animal is temporarily reserved. Not accepting new applications.
  ARCHIVED // Profile is no longer public (e.g., animal adopted, transferred, or otherwise unavailable) and is kept for records.
}

enum ApplicationStatus {
  PENDING // Application submitted, awaiting review
  REVIEWING // Application is actively being reviewed
  WAITLISTED // A strong application, held as a backup for a specific animal OR approved in general, waiting for a suitable animal.
  APPROVED // Application approved
  REJECTED // Application rejected
  WITHDRAWN // Application withdrawn by the user
  ADOPTED // animal has been adopted through this application (final state)
}

enum AnimalArchiveReason {
  ADOPTED_INTERNAL // Adopted through an application on this platform
  ADOPTED_EXTERNAL // Adopted through an external process (e.g., in-person event)
  TRANSFERRED // Moved to another rescue or shelter
  RETURNED_TO_OWNER
  DECEASED
  OTHER
}

enum LivingSituation {
  OWN_HOME
  RENT_APARTMENT
  RENT_HOUSE
  LIVE_WITH_FAMILY
  OTHER
}

enum AssociationType {
  OWNER
  FINDER
  SURRENDERER
  ADOPTER
  FOSTER_CARER
  VET_CONTACT
  INTERESTED_PARTY
  OTHER
}

enum PartnerType {
  SHELTER
  RESCUE_GROUP
  VET_CLINIC
  GOVERNMENT_AGENCY // e.g., Animal Control
}

model Partner {
  id   String      @id @default(cuid())
  name String      @unique
  type PartnerType

  // Contact Info
  contactPerson String?
  email         String?
  phone         String?
  address       String?
  city          String?
  state         String?
  zipCode       String?

  // Back-relations
  transferredInAnimals  Intake[]
  transferredOutAnimals Outcome[]

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@map("partners")
}

model Intake {
  id         String     @id @default(cuid())
  intakeDate DateTime   @default(now())
  type       IntakeType

  animalId String

  // The animal created as a result of this intake event. A one-to-one relationship.
  animal Animal @relation(fields: [animalId], references: [id])

  // Optional fields depending on the intake type

  // For OWNER_SURRENDER or RETURN
  surrenderingPersonId String?
  surrenderingPerson   Person? @relation(name: "SurrenderedBy", fields: [surrenderingPersonId], references: [id])

  // For STRAY
  dateLost        DateTime?
  foundAddress    String?
  foundCity       String?
  foundState      String?
  foundZipCode    String?
  foundByPersonId String?
  foundByPerson   Person?   @relation(name: "FoundBy", fields: [foundByPersonId], references: [id])

  // For TRANSFER_IN
  sourcePartnerId String?
  sourcePartner   Partner? @relation(fields: [sourcePartnerId], references: [id])

  // General fields
  staffMemberId String
  staffMember   Person  @relation(name: "ProcessedBy", fields: [staffMemberId], references: [id])
  notes         String?

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@map("intakes")
}

model Outcome {
  id          String      @id @default(cuid())
  outcomeDate DateTime    @default(now())
  type        OutcomeType

  animalId String
  // The animal leaving the shelter. A one-to-one relationship.
  animal   Animal @relation(fields: [animalId], references: [id])

  // Optional fields depending on the outcome type

  // For ADOPTION
  adoptionApplicationId String?              @unique
  adoptionApplication   AdoptionApplication? @relation(fields: [adoptionApplicationId], references: [id])

  // For RETURN_TO_OWNER
  ownerId String?
  owner   Person? @relation("ReclaimedByOwner", fields: [ownerId], references: [id])

  // For TRANSFER_OUT
  destinationPartnerId String?
  destinationPartner   Partner? @relation(fields: [destinationPartnerId], references: [id])

  // General fields
  staffMemberId String
  staffMember   Person  @relation(name: "ProcessedOutcome", fields: [staffMemberId], references: [id])
  notes         String?

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@map("outcomes")
}

model Animal {
  id              String               @id @default(cuid())
  name            String
  birthDate       DateTime             @map(name: "birth_date")
  sex             Sex
  size            AnimalSize?
  weightKg        Float?               @map(name: "weight_kg")
  heightCm        Float?               @map(name: "height_cm")
  city            String?
  state           String?
  description     String?
  listingStatus   AnimalListingStatus  @default(DRAFT)
  microchipNumber String?              @unique
  archiveReason   AnimalArchiveReason? /// Should only be set when listingStatus is ARCHIVED. Explains why the animal is no longer available.

  // Relations
  associatedPersons    AnimalAssociation[]
  // mandatory relationship to Species
  speciesId            String                @map("species_id")
  species              Species               @relation(fields: [speciesId], references: [id])
  breeds               Breed[]
  colors               Color[]
  characteristics      Characteristic[]
  animalImages         AnimalImage[]
  medicalRecords       MedicalRecord[]
  notes                Note[]
  tasks                Task[]
  likes                Like[]
  adoptionApplications AdoptionApplication[]
  intake               Intake[]
  Outcome              Outcome[]
  activityLog          AnimalActivityLog[]
  healthStatus         AnimalHealthStatus?
  legalStatus          AnimalLegalStatus?    @default(NONE)
  //  This is a "denormalized" field that you would update to true after a 
  // MedicalRecord for the procedure is created. It makes sorting and filtering trivial.

  // denormalized flags to animal
  // isMixedBreed    Boolean           @default(false)
  isSpayedNeutered Boolean @default(false)

  /// If the animal is currently in a foster home, this links to the active FosterProfile.
  fosterProfileId String?        @map(name: "foster_profile_id")
  fosterProfile   FosterProfile? @relation(fields: [fosterProfileId], references: [id])

  MedicationSchedule MedicationSchedule[]
  MedicationLog      MedicationLog[]
  assessments        Assessment[]

  createdAt DateTime @default(now()) @map(name: "created_at")
  updatedAt DateTime @updatedAt @map(name: "updated_at")

  @@map(name: "animals")
}

model Species {
  id      String   @id @default(cuid())
  name    String
  animals Animal[]
  breeds  Breed[] // A species can have many breeds

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@map(name: "species")
}

model Breed {
  id        String   @id @default(cuid())
  name      String
  animals   Animal[]
  speciesId String   @map(name: "species_id")
  species   Species  @relation(fields: [speciesId], references: [id])

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@unique([name, speciesId])
  @@map(name: "breeds")
}

model Color {
  id      String   @id @default(cuid())
  name    String   @unique // "Black", "White", "Brown", "Brindle", "Tabby"
  animals Animal[]

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@map(name: "colors")
}

model Characteristic {
  id       String                 @id @default(cuid())
  name     String // e.g., "Good with Kids", "Bite History", "Deaf"
  category CharacteristicCategory // The group this tag belongs to (BEHAVIOR, MEDICAL, etc.)

  // A list of all animals that have this characteristic
  animals Animal[]

  createdAt DateTime  @default(now())
  updatedAt DateTime  @updatedAt
  deletedAt DateTime? @map(name: "deleted_at")

  @@unique([name, category]) // Ensures "Deaf (MEDICAL)" is unique, etc.
  @@map("characteristics")
}

model Note {
  id       String       @id @default(cuid())
  category NoteCategory
  content  String

  animalId String @map(name: "animal_id")
  animal   Animal @relation(fields: [animalId], references: [id], onDelete: Cascade)

  authorId String @map(name: "author_id")
  author   Person @relation(fields: [authorId], references: [id], onDelete: Cascade)

  createdAt DateTime  @default(now())
  updatedAt DateTime  @updatedAt
  deletedAt DateTime? @map(name: "deleted_at")

  @@map(name: "notes")
}

model Task {
  id      String  @id @default(cuid())
  title   String
  details String?

  status   TaskStatus   @default(TODO)
  priority TaskPriority @default(MEDIUM)
  category TaskCategory
  dueDate  DateTime?    @map(name: "due_date") // Optional due date for the task

  animalId String @map(name: "animal_id")
  animal   Animal @relation(fields: [animalId], references: [id], onDelete: Cascade)

  /// The staff member this task is assigned to. Can be null if it's a general task for any staff.
  assigneeId String? @map(name: "assignee_id")
  assignee   Person? @relation("TasksAssignedTo", fields: [assigneeId], references: [id], onDelete: SetNull)

  medicationLog MedicationLog?

  createdById String @map("created_by_id")
  createdBy   Person @relation("TasksCreatedBy", fields: [createdById], references: [id])

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@map(name: "tasks")
}

model MedicalRecord {
  id           String            @id @default(cuid())
  type         MedicalRecordType
  title        String // e.g., "Rabies Vaccine", "Annual Checkup"
  details      String? // Longer notes from the vet or staff
  dateOfRecord DateTime          @map(name: "date_of_record") // The date the event occurred
  documentUrl  String?           @map(name: "document_url") // link to a PDF or image of the vet record

  animalId String @map(name: "animal_id")
  animal   Animal @relation(fields: [animalId], references: [id], onDelete: Cascade)

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@map(name: "medical_records")
}

/// Stores the application and approval status for a user wanting to become a foster parent.
model FosterProfile {
  id        String   @id @default(cuid())
  /// Represents a user's application and status as a foster parent.
  /// The `isActive` flag indicates they are approved and available to take in animals;
  /// it does NOT mean they are currently fostering a animal.
  isActive  Boolean  @default(false) @map(name: "is_active")
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  applicantPhone          String
  applicantAddressLine1   String
  applicantAddressLine2   String?
  applicantCity           String
  applicantState          String
  applicantZipCode        String
  livingSituation         LivingSituation
  hasYard                 Boolean?
  landlordPermission      Boolean?
  householdSize           Int
  hasChildren             Boolean?
  childrenAges            Int[]
  otherAnimalsDescription String?
  experience              String? // General experience with animals
  internalNotes           String? // For staff notes about the foster applicant
  /// A list of all animals this user has fostered in the past or is currently fostering.
  /// To see ONLY the currently fostered animals, query the Animal model for this fosterProfileId.
  animalsFostered         Animal[]

  userId String @unique @map(name: "user_id")
  user   Person @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@map("foster_profiles")
}

/// Represents a user's application to adopt a specific animal. This is a snapshot-in-time record.
model AdoptionApplication {
  id String @id @default(cuid())

  // Applicant details (snapshot in time for this specific application)
  applicantName         String  @map(name: "applicant_name")
  applicantEmail        String  @map(name: "applicant_email")
  applicantPhone        String  @map(name: "applicant_phone")
  applicantAddressLine1 String  @map(name: "applicant_address_line1")
  applicantAddressLine2 String? @map(name: "applicant_address_line2")
  applicantCity         String  @map(name: "applicant_city")
  applicantState        String  @map(name: "applicant_state")
  applicantZipCode      String  @map(name: "applicant_zip_code")

  // Home and lifestyle details
  livingSituation         LivingSituation @map(name: "living_situation")
  hasYard                 Boolean?        @map(name: "has_yard")
  landlordPermission      Boolean?        @map(name: "landlord_permission")
  householdSize           Int             @map(name: "household_size")
  hasChildren             Boolean?        @map(name: "has_children")
  childrenAges            Int[]           @map(name: "children_ages")
  otherAnimalsDescription String?         @map(name: "other_animals_description")
  animalExperience        String?         @map(name: "animal_experience")
  reasonForAdoption       String          @map(name: "reason_for_adoption")

  // Status and Workflow Management
  status        ApplicationStatus          @default(PENDING)
  internalNotes String? // For persistent staff notes about the application as a whole
  history       ApplicationStatusHistory[]
  outcome       Outcome?

  // Relations
  userId   String @map(name: "user_id")
  user     Person @relation(fields: [userId], references: [id], onDelete: Cascade)
  animalId String @map(name: "animal_id")
  animal   Animal @relation(fields: [animalId], references: [id], onDelete: Cascade)

  submittedAt DateTime @default(now()) @map(name: "submitted_at")
  updatedAt   DateTime @updatedAt @map(name: "updated_at")

  @@map(name: "adoption_applications")
}

model ApplicationStatusHistory {
  id            String              @id @default(cuid())
  applicationId String              @map(name: "application_id")
  application   AdoptionApplication @relation(fields: [applicationId], references: [id], onDelete: Cascade)

  status             ApplicationStatus // The status being set (e.g., APPROVED)
  statusChangeReason String // e.g., "Approved after a successful home visit." or a rejection reason.

  changedAt DateTime @default(now()) @map(name: "changed_at")

  changedById String? @map(name: "changed_by_id")
  changedBy   Person? @relation(fields: [changedById], references: [id], onDelete: SetNull)

  @@map(name: "application_status_history")
}

model Like {
  id String @id @default(cuid())

  animalId String @map(name: "animal_id")
  animal   Animal @relation(fields: [animalId], references: [id], onDelete: Cascade)

  userId String @map(name: "user_id")
  user   Person @relation(fields: [userId], references: [id], onDelete: Cascade)

  createdAt DateTime @default(now())

  @@unique([userId, animalId])
  @@map(name: "likes")
}

model AnimalImage {
  id  String @id @default(cuid())
  url String

  animalId String @map(name: "animal_id")
  animal   Animal @relation(fields: [animalId], references: [id], onDelete: Cascade)

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@map(name: "animal_images")
}

/// Links a Person to a Animal with a specific role or context.
model AnimalAssociation {
  id String @id @default(cuid())

  animalId String
  animal   Animal @relation(fields: [animalId], references: [id], onDelete: Cascade)

  personId String
  person   Person @relation(fields: [personId], references: [id], onDelete: Cascade)

  type         AssociationType
  notes        String?
  associatedAt DateTime        @default(now())

  @@unique([animalId, personId, type]) // Prevents creating the same association twice
  @@map("animal_associations")
}

model Person {
  id      String     @id @default(cuid())
  name    String
  type    PersonType @default(INDIVIDUAL)
  email   String?    @unique
  phone   String?
  address String?
  city    String?
  state   String?
  zipCode String?

  // A Person MIGHT have a user account for logging in.
  user User?

  // Back-relations to all their interactions
  fosterProfile            FosterProfile?
  adoptionApplications     AdoptionApplication[]
  applicationStatusHistory ApplicationStatusHistory[]
  likes                    Like[]
  notesAuthored            Note[]
  tasksAssigned            Task[]                     @relation("TasksAssignedTo")
  tasksCreated             Task[]                     @relation("TasksCreatedBy")
  reclaimedAnimalsAsOwner  Outcome[]                  @relation("ReclaimedByOwner")
  processedOutcomes        Outcome[]                  @relation("ProcessedOutcome")
  surrenderedAnimals       Intake[]                   @relation("SurrenderedBy")
  foundAnimals             Intake[]                   @relation("FoundBy")
  processedIntakes         Intake[]                   @relation("ProcessedBy")
  animalAssociations       AnimalAssociation[] // For the "Associated People" feature

  // financialTransactions  FinancialTransaction[]
  // processedTransactions  FinancialTransaction[] @relation("ProcessedFinance")
  // licenses               License[]

  createdAt         DateTime            @default(now())
  updatedAt         DateTime            @updatedAt
  MedicationLog     MedicationLog[]
  Assessment        Assessment[]
  AnimalActivityLog AnimalActivityLog[]

  @@map("persons")
}

model User {
  id            String    @id @default(cuid())
  email         String    @unique // Kept here for Auth.js/NextAuth compatibility
  emailVerified DateTime? @map(name: "email_verified")
  password      String?
  image         String?
  role          Role      @default(USER)

  // The one-to-one link to the master Person record
  personId String @unique
  person   Person @relation(fields: [personId], references: [id], onDelete: Cascade)

  accounts Account[]

  createdAt DateTime @default(now()) @map(name: "created_at")
  updatedAt DateTime @updatedAt @map(name: "updated_at")

  @@map(name: "users")
}

model Account {
  userId            String  @map(name: "user_id")
  type              String
  provider          String
  providerAccountId String  @map(name: "provider_account_id")
  access_token      String?
  token_type        String?
  scope             String?

  createdAt DateTime @default(now()) @map(name: "created_at")
  updatedAt DateTime @updatedAt @map(name: "updated_at")

  user User @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@id([provider, providerAccountId])
  @@map(name: "accounts")
}

// Shelters deal with dozens of animals on different medications with varying schedules 
// (twice a day, every 3 days, etc.). Automating this prevents missed doses, which is critical for animal health.
// Using Cron Jobs

// In this scenario, MedicalRecord can be used for one-off events
// like vaccines or procedures, while MedicationLog handles recurring treatments.
model MedicationSchedule {
  id             String  @id @default(cuid())
  medicationName String // e.g., "Doxycycline", "Metronidazole"
  dosage         Float // e.g., 100, 0.5
  dosageUnit     String // e.g., "mg", "ml", "tablet(s)"
  route          String // e.g., "Oral", "Topical", "Injectable"
  instructions   String?
  isActive       Boolean @default(true)

  // Recurrence Info
  startDate      DateTime
  repeatInterval Int // e.g., 1
  repeatUnit     String // "Days", "Weeks"
  timesPerDay    Int       @default(1) // How many times within that day
  endByDate      DateTime?

  animalId String @map("animal_id")
  animal   Animal @relation(fields: [animalId], references: [id], onDelete: Cascade)

  // Link to the logs of when this was administered
  administrations MedicationLog[]

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@map("medication_schedules")
}

// Model to log every single time a medication is given
model MedicationLog {
  id String @id @default(cuid())

  administeredAt DateTime @default(now())
  notes          String?

  // The staff member who gave the medication
  administeredById String
  administeredBy   Person @relation(fields: [administeredById], references: [id])

  // The schedule this administration belongs to
  scheduleId String
  schedule   MedicationSchedule @relation(fields: [scheduleId], references: [id], onDelete: Cascade)

  // The animal who received it (denormalized for easy querying)
  animalId String
  animal   Animal @relation(fields: [animalId], references: [id], onDelete: Cascade)

  // Optionally, link to the task that prompted this action
  taskId String? @unique
  task   Task?   @relation(fields: [taskId], references: [id], onDelete: SetNull)

  @@map("medication_logs")
}

enum AssessmentType {
  INTAKE_MEDICAL
  INTAKE_BEHAVIORAL
  DAILY_MONITORING
  PLAYGROUP_EVALUATION
  CAT_TEST
  DOG_TEST
  HANDLING_SENSITIVITY
  LEASH_MANNER
  QUARANTINE_CHECK
  POST_ADOPTION_FOLLOWUP
  OTHER
}

enum AssessmentOutcome {
  EXCELLENT
  GOOD
  FAIR
  POOR
  NEEDS_ATTENTION
  MONITOR
  NOT_APPLICABLE
}

model Assessment {
  id             String             @id @default(cuid())
  animalId       String
  animal         Animal             @relation(fields: [animalId], references: [id], onDelete: Cascade)
  assessorId     String
  assessor       Person             @relation(fields: [assessorId], references: [id])
  date           DateTime           @default(now())
  overallOutcome AssessmentOutcome?
  summary        String? // A text summary of the findings, e.g., "Ready for adoption"

  templateId String?
  template AssessmentTemplate? @relation(fields: [templateId], references: [id])

  // Link to a list of specific answers/findings
  fields AssessmentField[]

  createdAt DateTime  @default(now())
  updatedAt DateTime  @updatedAt
  deletedAt DateTime? @map(name: "deleted_at")

  @@map("assessments")
}

// A model for each individual question/field within an assessment
model AssessmentField {
  id           String     @id @default(cuid())
  assessmentId String
  assessment   Assessment @relation(fields: [assessmentId], references: [id], onDelete: Cascade)

  // What was being assessed?
  // e.g., "Reaction to handling", "Food guarding", "Heart murmur"
  fieldName String

  // The result of the assessment for that field
  // e.g., "Tolerant", "Severe", "Grade 2/6 Systolic"
  fieldValue String

  // Optional longer notes for this specific field
  notes String?

  createdAt DateTime @default(now())

  @@map("assessment_fields")
}

// To define a type of assessment, like "Intake Behavioral"
model AssessmentTemplate {
  id                String          @id @default(cuid())
  name              String          @unique // e.g., "Intake Behavioral", "Daily Monitoring"
  description       String?
  type              AssessmentType

  allowCustomFields Boolean         @default(true) // Controls if staff can add ad-hoc fields during assessment
  templateFields    TemplateField[]
  Assessment Assessment[]

  createdAt  DateTime     @default(now())
  updatedAt  DateTime     @updatedAt

  @@map("assessment_templates")
}

enum FieldType {
  TEXT      // Single-line text input
  TEXTAREA  // Multi-line text area
  NUMBER    // Numerical input
  SELECT    // Dropdown list from options
  CHECKBOX  // A single checkbox (for boolean true/false)
  RADIO     // Radio buttons for single selection
  DATE      // A date picker
}

model TemplateField {
  id         String             @id @default(cuid())
  templateId String
  template   AssessmentTemplate @relation(fields: [templateId], references: [id], onDelete: Cascade)

  label       String // e.g., "Kennel Presence"
  fieldType   FieldType // e.g., "SELECT", "TEXT", "NUMBER"
  placeholder String?
  options     String[] // For SELECT, stores ["Quiet", "Anxious", "Barking"]
  isRequired  Boolean  @default(true)
  order       Int // To control the display order in the form

  @@map("assessment_template_fields")
}

model AnimalActivityLog {
  id           String             @id @default(cuid())
  activityType AnimalActivityType

  animalId String
  animal   Animal @relation(fields: [animalId], references: [id], onDelete: Cascade)

  changedById String
  changedBy   Person @relation(fields: [changedById], references: [id])

  // This is the key field. It will store a human-readable summary.
  // For PostgreSQL, you could even use the `Json` type here for more structured data.
  // But a formatted string is perfectly fine and database-agnostic.
  changeSummary String?

  changedAt DateTime @default(now())

  @@map("animal_activity_logs")
}

// // ================== Future models ==================
// // ============ Medication Scheduling & Logs ============
// // Shelters deal with dozens of animals on different medications with varying schedules 
// // (twice a day, every 3 days, etc.). Automating this prevents missed doses, which is critical for animal health.
// // Using Cron Jobs

// In this scenario, MedicalRecord can be used for one-off events
// like vaccines or procedures, while MedicationLog handles recurring treatments.
// model MedicationSchedule {
//   id             String  @id @default(cuid())
//   medicationName String // e.g., "Doxycycline", "Metronidazole"
//   dosage         Float // e.g., 100, 0.5
//   dosageUnit     String // e.g., "mg", "ml", "tablet(s)"
//   route          String // e.g., "Oral", "Topical", "Injectable"
//   instructions   String?
//   isActive       Boolean @default(true)

//   // Recurrence Info
//   startDate      DateTime
//   repeatInterval Int // e.g., 1
//   repeatUnit     String // "Days", "Weeks"
//   timesPerDay    Int       @default(1) // How many times within that day
//   endByDate      DateTime?

//   animalId String @map("animal_id")
//   animal   Animal    @relation(fields: [animalId], references: [id], onDelete: Cascade)

//   // Link to the logs of when this was administered
//   administrations MedicationLog[]

//   createdAt DateTime @default(now())
//   updatedAt DateTime @updatedAt

//   @@map("medication_schedules")
// }

// // Model to log every single time a medication is given
// model MedicationLog {
//   id String @id @default(cuid())

//   administeredAt DateTime @default(now())
//   notes          String?

//   // The staff member who gave the medication
//   administeredById String
//   administeredBy   Person @relation(fields: [administeredById], references: [id])

//   // The schedule this administration belongs to
//   scheduleId String
//   schedule   MedicationSchedule @relation(fields: [scheduleId], references: [id], onDelete: Cascade)

//   // The animal who received it (denormalized for easy querying)
//   animalId String
//   animal   Animal    @relation(fields: [animalId], references: [id], onDelete: Cascade)

//   // Optionally, link to the task that prompted this action
//   taskId String? @unique
//   task   Task?   @relation(fields: [taskId], references: [id], onDelete: SetNull)

//   @@map("medication_logs")
// }

// // ============ Behavioral Assessment Tracking ============
// // Standardized assessments help track a animal's progress over time and provide objective data for potential adopters
// //  (e.g., food aggression score, confidence level).

// model BehavioralAssessment {
//   id                 String    @id @default(cuid())
//   animalId              String
//   animal                animal       @relation(fields: [animalId], references: [id], onDelete: Cascade)
//   assessedById       String
//   assessedBy         User      @relation(fields: [assessedById], references: [id])
//   assessmentDate     DateTime  @default(now())

//   // Example numeric scores (1-5)
//   confidenceScore    Int?
//   sociabilityScore   Int? // With other animals
//   humanAffinityScore Int?
//   foodAggressionScore Int?

//   summaryNotes       String

//   @@map("behavioral_assessments")
// }

// // ============ Volunteer Management & Scheduling ============
// // To manage who is coming in, when, and for what job (e.g., dog walking, cleaning, front desk). 
// // This prevents over/under staffing of volunteers.

// model VolunteerJob {
//   id          String   @id @default(cuid())
//   title       String   @unique // "Dog Walker", "Cat Cuddler", "Cleaning Crew"
//   description String?
//   shifts      Shift[]

//   @@map("volunteer_jobs")
// }
// model Shift {
//   id           String            @id @default(cuid())
//   jobId        String
//   job          VolunteerJob      @relation(fields: [jobId], references: [id])
//   startTime    DateTime
//   endTime      DateTime
//   slots        Int               // Number of volunteers needed
//   signups      VolunteerShift[]

//   @@map("shifts")
// }
// model VolunteerShift {
//   id           String    @id @default(cuid())
//   volunteerId  String
//   volunteer    User      @relation(fields: [volunteerId], references: [id])
//   shiftId      String
//   shift        Shift     @relation(fields: [shiftId], references: [id])
//   checkInTime  DateTime?
//   checkOutTime DateTime?
//   status       String    // "Confirmed", "Cancelled", "No-Show"

//   @@unique([volunteerId, shiftId])
//   @@map("volunteer_signups")
// }

// // ============ Donation & Financial Tracking ============ 
// // To maintain donor records, send thank-you notes, and generate reports 
// // for financial oversight and grant applications.

// enum DonationType {
//   MONETARY
//   IN_KIND // Physical item donation
// }
// model Donation {
//   id            String       @id @default(cuid())
//   amount        Float?       // For monetary donations
//   currency      String?      @default("USD")
//   inKindItem    String?      // e.g., "10 bags of dog food"
//   donationType  DonationType
//   donationDate  DateTime     @default(now())

//   donorId       String?      // Donors may not always have a user account
//   donor         User?        @relation(fields: [donorId], references: [id])
//   donorName     String?      // For anonymous/guest donations
//   donorEmail    String?

//   notes         String?
//   paymentIntentId String?    @unique // From Stripe or another processor

//   @@map("donations")
// }

// // ============ Centralized Communications Log ============ 
// // To provide a complete history. If an adopter calls with a question, 
// // any staff member can look up their record and see all previous notes, emails, or calls.

// enum CommunicationType {
//   EMAIL
//   PHONE_CALL
//   SMS
//   IN_PERSON
//   NOTE
// }
// model CommunicationLog {
//   id                 String            @id @default(cuid())
//   type               CommunicationType
//   subject            String
//   body               String
//   direction          String            // "Inbound" or "Outbound"
//   communicationDate  DateTime          @default(now())

//   // Links
//   authorId           String            // The staff member who logged this
//   author             User              @relation(fields: [authorId], references: [id])

//   // You can link a communication to different entities
//   animalId              String?
//   animal                Animal?              @relation(fields: [animalId], references: [id])

//   adoptionAppId      String?
//   adoptionApplication AdoptionApplication? @relation(fields: [adoptionAppId], references: [id])

//   personId           String?            // Could be a User ID for a donor, volunteer, etc.
//   person             User?              @relation(name: "RelatedPersonComm", fields: [personId], references: [id])

//   @@map("communication_logs")
// }

// enum TransactionType {
//   DONATION
//   ADOPTION_FEE
//   SERVICE_FEE // e.g., microchipping
//   REFUND
//   OTHER
// }

// enum TransactionDirection {
//   CREDIT // Money coming IN
//   DEBIT  // Money going OUT (e.g., a refund)
// }

// model FinancialTransaction {
//   id            String               @id @default(cuid())
//   type          TransactionType
//   direction     TransactionDirection
//   amount        Float                // Always a positive number
//   currency      String               @default("USD")
//   transactionDate DateTime           @default(now())

//   // Link to the person involved
//   personId      String?
//   person        User?                @relation(fields: [personId], references: [id])

//   // Link to the adoption application if it's an adoption fee/refund
//   adoptionApplicationId String?
//   adoptionApplication   AdoptionApplication? @relation(fields: [adoptionApplicationId], references: [id])

//   staffMemberId String
//   staffMember   User                 @relation(name: "ProcessedFinance", fields: [staffMemberId], references: [id])

//   notes           String?
//   paymentMethod   String?            // "Cash", "Credit Card", "Check"
//   paymentIntentId String?            @unique // From Stripe or another processor for traceability

// createdAt DateTime @default(now())
// updatedAt DateTime @updatedAt

//   @@map("financial_transactions")
// }
